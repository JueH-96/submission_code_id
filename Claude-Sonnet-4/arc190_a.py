Wait, let me reconsider. The constraints show M â‰¤ 200000, which means 3^M is definitely too large. I need a completely different approach.

Let me think about this as a minimum cost set cover problem and use dynamic programming on the set of covered positions.